<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Komentarze - FinoGrona</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Komentarze</h1>
        <nav>
            <a href="index.html">Strona Główna</a>
            <a href="menu.html">Menu</a>
            <a href="about.html">O nas</a>
            <a href="contact.html">Kontakt</a>
        </nav>
    </header>

    <main>
        <h2>Podziel się swoją opinią!</h2>
        <textarea id="commentInput" placeholder="Napisz komentarz..." rows="4"></textarea><br>
        <button onclick="addComment()">Dodaj komentarz</button>

        <h2>Opinie klientów</h2>
        <ul id="commentList"></ul>
    </main>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.5.0/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.5.0/firebase-firestore.js"></script>

    <!-- Skrypt obsługujący komentarze -->
    <script type="module">
        // Importowanie funkcji Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-analytics.js";

        // Konfiguracja Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyC4V0bkhm7nEFsZ0tvFHkOdnnmTwOmjNqY",
            authDomain: "finogrona-5737f.firebaseapp.com",
            projectId: "finogrona-5737f",
            storageBucket: "finogrona-5737f.firebasestorage.app",
            messagingSenderId: "546698739322",
            appId: "1:546698739322:web:23d5486634b85c966905c3",
            measurementId: "G-XP4BFHNSBB"
        };

        // Inicjalizacja Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);

        // Funkcja do dodawania komentarza do Firestore
        async function addComment() {
            const commentInput = document.getElementById("commentInput").value.trim();
            if (commentInput === "") return; // Jeśli pole jest puste, nie wykonuj żadnej akcji

            try {
                // Dodawanie komentarza do Firestore
                await addDoc(collection(db, "comments"), {
                    text: commentInput,
                    timestamp: new Date() // Zapisujemy czas dodania komentarza
                });

                // Czyszczenie pola po dodaniu komentarza
                document.getElementById("commentInput").value = "";
            } catch (e) {
                console.error("Błąd podczas dodawania komentarza: ", e);
            }
        }

        // Funkcja do pobierania i wyświetlania komentarzy
        function loadComments() {
            const commentList = document.getElementById("commentList");
            const q = query(collection(db, "comments"), orderBy("timestamp", "desc")); // Sortowanie po czasie

            // Subskrypcja na zmiany w bazie danych (w czasie rzeczywistym)
            onSnapshot(q, (querySnapshot) => {
                commentList.innerHTML = ""; // Czyszczenie listy komentarzy
                querySnapshot.forEach((doc) => {
                    const li = document.createElement("li");
                    li.textContent = doc.data().text;
                    commentList.appendChild(li);
                });
            });
        }

        // Ładowanie komentarzy po załadowaniu strony
        document.addEventListener("DOMContentLoaded", loadComments);
    </script>
</body>
</html>
